<!DOCTYPE html>
<html>
   <head>
      <title>Morse Code Translator</title>
      <script src="https://cdn.jsdelivr.net/npm/tone@14.7.77/build/Tone.min.js"></script>
   </head>
   <body>
      <h1>Morse Code Translator</h1>
      <input id="inputarea" type="text"><button id="method">Encode</button><button id="translate">Translate</button><button id="playsound">Play Sound</button>
      <br>
      <p id="translated"></p>
      <script>
         var methodbutton = document.getElementById("method");
         var translationbutton = document.getElementById("translate");
         var playsoundbutton = document.getElementById("playsound");
         var inputarea = document.getElementById("inputarea");
         var output = document.getElementById("translated");
         var morsecode = "";
         
         methodbutton.addEventListener('click',function() {
            if (methodbutton.innerHTML == "Encode"){
               methodbutton.innerHTML = "Decode";
            } else {
               methodbutton.innerHTML = "Encode";
            }
         });
         // Morse Code Translation
         
         const charToMorse = {'!':"-.-.--",'"':".-..-.",'$':"...-..-",'&':".-...","'":".----.",'(':"-.--.",')':"-.--.-",'+':".-.-.",',':"--..--",'-':"-....-",'.':".-.-.-",'/':"-..-.",'0':"-----",'1':".----",'2':"..---",'3':"...--",'4':"....-",'5':".....",'6':"-....",'7':"--...",'8':"---..",'9':"----.",':':"---...",';':"-.-.-.",'=':"-...-",'?':"..--..",'@':".--.-.",'_':"..--.-",'A':".-",'B':"-...",'C':"-.-.",'D':"-..",'E':".",'F':"..-.",'G':"--.",'H':"....",'I':"..",'J':".---",'K':"-.-",'L':".-..",'M':"--",'N':"-.",'O':"---",'P':".--.",'Q':"--.-",'R':".-.",'S':"...",'T':"-",'U':"..-",'V':"...-",'W':".--",'X':"-..-",'Y':"-.--",'Z':"--.."};
         const morseToChar = Object.fromEntries(Object.entries(charToMorse).map(([k, v]) => [v, k]));
         
         function textToMorse(msg) {
            const out = [...msg.toUpperCase()].map(x => charToMorse[x] || '');
            return out.join('&nbsp');
         }
         
         function morseToText(morse) {
            return morse.split('  ').map(word => {
               return word.split(' ').map(code => morseToChar[code] || '').join('');
            }).join(' ');
         }
         
         async function playMorseSound(morse) {
            morse = morse.replace(/&nbsp/g," ");
            const synth = new Tone.Synth({
               oscillator: {
                  type: 'sine'
               },
               envelope: {
                  attack: 0.1,
                  decay: 0.2,
                  sustain: 0.1,
                  release: 0.5
               }
            });
            const notes = {
               '.': 'C4',
               '-': 'E4'
            }
            
            const timeunit = 150;
            const noteLength = timeunit * 0.9;
            const dotLength = timeunit * 1;
            const dashLength = timeunit * 3;
            const gapLength = timeunit;
            const wordGapLength = timeunit * 7;
        
            for (let i = 0; i < morse.length; i++) {
               const c = morse.charAt(i);
               if (c == '.') {
                  synth.triggerAttackRelease(notes['.'], dotLength / 1000);
                  await sleep(noteLength);
               } else if (c == '-') {
                  synth.triggerAttackRelease(notes['-'], dashLength / 1000);
                  await sleep(noteLength);
               } else if (c == ' ') {
                  await sleep(gapLength);
               } else if (c == '&') {
                  await sleep(wordGapLength);
               }
            }
         }
     
        function sleep(ms) {
           return new Promise(resolve => setTimeout(resolve, ms));
        }
     
        translationbutton.addEventListener('click', function() {
           if (methodbutton.innerHTML == "Encode") {
              morsecode = textToMorse(inputarea.value);
           } else {
              morsecode = morseToText(inputarea.value);
           }
           output.innerHTML = morsecode;
        });
     
        playsoundbutton.addEventListener('click', async function() {
           await playMorseSound(morsecode);
        });
      </script>
   </body>
</html>
